<html>
<head>
<title>2-ProcessResults.ipynb</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #75715e;}
.s1 { color: #66d9ef; font-style: italic;}
.s2 { color: #f8f8f2;}
.s3 { color: #f92672;}
.s4 { color: #e6db74;}
.s5 { color: #ae81ff;}
</style>
</head>
<body bgcolor="#272822">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
2-ProcessResults.ipynb</font>
</center></td></tr></table>
<pre><span class="s0">#%% 
</span><span class="s1">import </span><span class="s2">pandas </span><span class="s1">as </span><span class="s2">pd</span>

<span class="s3">% </span><span class="s2">matplotlib inline</span>
<span class="s1">import </span><span class="s2">matplotlib.pyplot </span><span class="s1">as </span><span class="s2">plt</span>
<span class="s1">import </span><span class="s2">seaborn </span><span class="s1">as </span><span class="s2">sns</span>

<span class="s2">sns.set_context(</span><span class="s4">'notebook'</span><span class="s2">)</span>
<span class="s2">sns.set_style(</span><span class="s4">&quot;whitegrid&quot;</span><span class="s2">)</span>
<span class="s2">sns.set_palette(</span><span class="s4">&quot;Set2&quot;</span><span class="s2">)  </span><span class="s0">#colorblind</span>
<span class="s1">import </span><span class="s2">matplotlib_inline</span>

<span class="s2">matplotlib_inline.backend_inline.set_matplotlib_formats(</span><span class="s4">'retina'</span><span class="s2">)</span>

<span class="s1">import </span><span class="s2">plotly.express </span><span class="s1">as </span><span class="s2">px</span>
<span class="s1">from </span><span class="s2">plotly.offline </span><span class="s1">import </span><span class="s2">init_notebook_mode</span>
<span class="s2">init_notebook_mode()</span>
<span class="s0">#%% md 
</span><span class="s2"># 1. Importing the data 
</span><span class="s0">#%% 
</span><span class="s2">file_name </span><span class="s3">= </span><span class="s4">&quot;2022-07-10-courses&quot;</span>
<span class="s2">concepts_list </span><span class="s3">= </span><span class="s4">&quot;Input/planetary_boundaries_social_keywords.csv&quot;</span>

<span class="s2">data </span><span class="s3">= </span><span class="s2">pd.read_csv(</span><span class="s4">f'./Output/</span><span class="s5">{</span><span class="s2">file_name</span><span class="s5">}</span><span class="s4">.csv'</span><span class="s2">)</span>
<span class="s2">data.head()</span>
<span class="s0">#%% md 
</span><span class="s2">## 1.1 Spot not found keywords 
Cross check which keyword did not correspond to any concept 
</span><span class="s0">#%% 
</span><span class="s2">list(pd.read_csv(concepts_list)[</span><span class="s4">&quot;0&quot;</span><span class="s2">])</span>
<span class="s0">#%% 
</span><span class="s2">df </span><span class="s3">= </span><span class="s2">pd.read_csv(concepts_list)</span>
<span class="s2">keywords_look </span><span class="s3">= </span><span class="s2">list(df[</span><span class="s4">'0'</span><span class="s2">])</span>
<span class="s2">keywords_look </span><span class="s3">= </span><span class="s2">[e.capitalize() </span><span class="s1">for </span><span class="s2">e </span><span class="s1">in </span><span class="s2">keywords_look]</span>

<span class="s2">keywords_found </span><span class="s3">= </span><span class="s2">list(data[</span><span class="s4">'PageTitle'</span><span class="s2">].unique())</span>

<span class="s2">keywords_miss </span><span class="s3">= </span><span class="s2">list(set(keywords_look) </span><span class="s3">- </span><span class="s2">set(keywords_found))</span>

<span class="s2">print(len(keywords_look), len(keywords_found), len(keywords_miss))</span>
<span class="s0"># Find indexes</span>
<span class="s2">indices </span><span class="s3">= </span><span class="s2">[keywords_look.index(x) </span><span class="s1">for </span><span class="s2">x </span><span class="s1">in </span><span class="s2">keywords_miss]</span>
<span class="s2">df_out </span><span class="s3">= </span><span class="s2">df.iloc[indices]</span>
<span class="s2">df_out.to_csv(</span><span class="s4">'./unrecognized_keywords.csv'</span><span class="s2">)</span>
<span class="s0">#%% 
</span><span class="s2">keywords_miss</span>
<span class="s0">#%% 
</span><span class="s2">data[</span><span class="s4">&quot;CourseCode&quot;</span><span class="s2">].nunique()</span>
<span class="s0">#%% 
</span><span class="s2">(pd.DataFrame(data[</span><span class="s4">&quot;PageTitle&quot;</span><span class="s2">].unique())).to_csv(</span><span class="s4">&quot;./Output/obtained_courses_keywords.csv&quot;</span><span class="s2">)</span>
<span class="s0">#%% md 
</span><span class="s2">### Unique concepts by program type (level) 
</span><span class="s0">#%% 
</span><span class="s2">studyplans </span><span class="s3">= </span><span class="s2">data.groupby([</span><span class="s4">&quot;StudyPlanLevelEN&quot;</span><span class="s2">])[</span><span class="s4">&quot;StudyPlanNameEN&quot;</span><span class="s2">].agg([</span><span class="s4">&quot;nunique&quot;</span><span class="s2">, </span><span class="s4">&quot;unique&quot;</span><span class="s2">])</span>
<span class="s0">#studyplans.to_csv('studyplans.csv', sep=&quot;,&quot;)</span>
<span class="s2">studyplans</span>
<span class="s0">#%% md 
</span><span class="s2"># 2. Data processing 
## 2.1 Ordering curriculum types by level 
</span><span class="s0">#%% 
</span><span class="s2">data[</span><span class="s4">&quot;AcademicYear&quot;</span><span class="s2">] </span><span class="s3">= </span><span class="s2">data[</span><span class="s4">&quot;AcademicYear&quot;</span><span class="s2">].astype(</span><span class="s4">'category'</span><span class="s2">)</span>

<span class="s2">data[</span><span class="s4">&quot;StudyPlanLevelEN&quot;</span><span class="s2">] </span><span class="s3">= </span><span class="s2">data[</span><span class="s4">&quot;StudyPlanLevelEN&quot;</span><span class="s2">].astype(</span><span class="s4">'category'</span><span class="s2">)</span>
<span class="s0">#data[&quot;StudyPlanLevelEN&quot;].cat.categories</span>
<span class="s2">data[</span><span class="s4">&quot;StudyPlanLevelEN&quot;</span><span class="s2">].cat.reorder_categories(</span>
    <span class="s2">[</span><span class="s4">'Propedeutics'</span><span class="s2">, </span><span class="s4">'Bachelor Cycle'</span><span class="s2">, </span><span class="s4">'Master Cycle'</span><span class="s2">, </span><span class="s4">'Minor'</span><span class="s2">, </span><span class="s4">'Doctoral School'</span><span class="s2">], inplace</span><span class="s3">=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s2">data[</span><span class="s4">&quot;StudyPlanNameEN&quot;</span><span class="s2">] </span><span class="s3">= </span><span class="s2">data[</span><span class="s4">&quot;StudyPlanNameEN&quot;</span><span class="s2">].astype(</span><span class="s4">'category'</span><span class="s2">)</span>
<span class="s0">#data[&quot;StudyPlanNameEN&quot;].cat.categories</span>
<span class="s0">#%% md 
</span><span class="s2">## 2.2 Grouping of program sections by faculty 
</span><span class="s0">#%% 
</span><span class="s2">data[</span><span class="s4">&quot;SectionCode&quot;</span><span class="s2">] </span><span class="s3">= </span><span class="s2">data[</span><span class="s4">&quot;SectionCode&quot;</span><span class="s2">].astype(</span><span class="s4">'category'</span><span class="s2">)</span>
<span class="s2">data[</span><span class="s4">&quot;SectionCode&quot;</span><span class="s2">].cat.categories</span>
<span class="s0">#%% raw 
</span><span class="s2">###### BAD SYNTAX! 
data.loc[data[&quot;SectionCode&quot;] == (&quot;EL&quot; or &quot;GM&quot; or &quot;MT&quot; or &quot;MX&quot; or &quot;EDEE&quot; or &quot;EDME&quot; or &quot;EDMI&quot; or &quot;EDMX&quot; or &quot;EDRS&quot; or &quot;EDEY&quot; or &quot;EDAM&quot; or &quot;EDPO&quot;), &quot;FacultyCode&quot;] = &quot;STI&quot; 
data.loc[data[&quot;SectionCode&quot;] == (&quot;MA&quot; or &quot;PH&quot; or &quot;CGC&quot; or &quot;EDMA&quot; or &quot;EDPY&quot; or &quot;EDCH&quot;), &quot;FacultyCode&quot;] = &quot;SB&quot; 
data.loc[data[&quot;SectionCode&quot;] == (&quot;AR&quot; or &quot;GC&quot; or &quot;SIE&quot; or &quot;EDAR&quot; or &quot;EDCE&quot;), &quot;FacultyCode&quot;] = &quot;ENAC&quot; 
data.loc[data[&quot;SectionCode&quot;] == (&quot;IN&quot; or &quot;SC&quot; or &quot;EDIC&quot;), &quot;FacultyCode&quot;] = &quot;IC&quot; 
data.loc[data[&quot;SectionCode&quot;] == (&quot;SV&quot; or &quot;EDMS&quot; or &quot;EDNE&quot; or &quot;EDCB&quot; or &quot;EDBB&quot;), &quot;FacultyCode&quot;] = &quot;SV&quot; 
data.loc[data[&quot;SectionCode&quot;] == (&quot;MTE&quot; or &quot;IF&quot; or &quot;EDMT&quot; or &quot;EDFI&quot;), &quot;FacultyCode&quot;] = &quot;CDM&quot; 
data.loc[data[&quot;SectionCode&quot;] == (&quot;SHS&quot; or &quot;DH&quot; or &quot;EDDH&quot;), &quot;FacultyCode&quot;] = &quot;CDH&quot; 
data[&quot;FacultyCode&quot;] = data[&quot;FacultyCode&quot;].astype('category') 
data[&quot;FacultyCode&quot;].cat.categories 
#data[&quot;FacultyCode&quot;].cat.reorder_categories(['STI', 'SB', 'IC', 'ENAC', 'SV', 'CDM', 'CDH'], inplace=True) 
#data[&quot;FacultyCode&quot;].cat.reorder_categories(['STI', 'SB', 'IC', 'ENAC', 'SV', 'CDH'], inplace=True) 
</span><span class="s0">#%% 
</span><span class="s2">data.loc[data[</span><span class="s4">&quot;SectionCode&quot;</span><span class="s2">].isin(</span>
    <span class="s2">[</span><span class="s4">&quot;EL&quot;</span><span class="s2">, </span><span class="s4">&quot;GM&quot;</span><span class="s2">, </span><span class="s4">&quot;MT&quot;</span><span class="s2">, </span><span class="s4">&quot;MX&quot;</span><span class="s2">, </span><span class="s4">&quot;EDEE&quot;</span><span class="s2">, </span><span class="s4">&quot;EDME&quot;</span><span class="s2">, </span><span class="s4">&quot;EDMI&quot;</span><span class="s2">, </span><span class="s4">&quot;EDMX&quot;</span><span class="s2">, </span><span class="s4">&quot;EDRS&quot;</span><span class="s2">, </span><span class="s4">&quot;EDEY&quot;</span><span class="s2">, </span><span class="s4">&quot;EDAM&quot;</span><span class="s2">, </span><span class="s4">&quot;EDPO&quot;</span><span class="s2">]), </span><span class="s4">&quot;FacultyCode&quot;</span><span class="s2">] </span><span class="s3">= </span><span class="s4">&quot;STI&quot;</span>
<span class="s2">data.loc[data[</span><span class="s4">&quot;SectionCode&quot;</span><span class="s2">].isin([</span><span class="s4">&quot;MA&quot;</span><span class="s2">, </span><span class="s4">&quot;PH&quot;</span><span class="s2">, </span><span class="s4">&quot;CGC&quot;</span><span class="s2">, </span><span class="s4">&quot;EDMA&quot;</span><span class="s2">, </span><span class="s4">&quot;EDPY&quot;</span><span class="s2">, </span><span class="s4">&quot;EDCH&quot;</span><span class="s2">]), </span><span class="s4">&quot;FacultyCode&quot;</span><span class="s2">] </span><span class="s3">= </span><span class="s4">&quot;SB&quot;</span>
<span class="s2">data.loc[data[</span><span class="s4">&quot;SectionCode&quot;</span><span class="s2">].isin([</span><span class="s4">&quot;AR&quot;</span><span class="s2">, </span><span class="s4">&quot;GC&quot;</span><span class="s2">, </span><span class="s4">&quot;SIE&quot;</span><span class="s2">, </span><span class="s4">&quot;EDAR&quot;</span><span class="s2">, </span><span class="s4">&quot;EDCE&quot;</span><span class="s2">]), </span><span class="s4">&quot;FacultyCode&quot;</span><span class="s2">] </span><span class="s3">= </span><span class="s4">&quot;ENAC&quot;</span>
<span class="s2">data.loc[data[</span><span class="s4">&quot;SectionCode&quot;</span><span class="s2">].isin([</span><span class="s4">&quot;IN&quot;</span><span class="s2">, </span><span class="s4">&quot;SC&quot;</span><span class="s2">, </span><span class="s4">&quot;EDIC&quot;</span><span class="s2">]), </span><span class="s4">&quot;FacultyCode&quot;</span><span class="s2">] </span><span class="s3">= </span><span class="s4">&quot;IC&quot;</span>
<span class="s2">data.loc[data[</span><span class="s4">&quot;SectionCode&quot;</span><span class="s2">].isin([</span><span class="s4">&quot;SV&quot;</span><span class="s2">, </span><span class="s4">&quot;EDMS&quot;</span><span class="s2">, </span><span class="s4">&quot;EDNE&quot;</span><span class="s2">, </span><span class="s4">&quot;EDCB&quot;</span><span class="s2">, </span><span class="s4">&quot;EDBB&quot;</span><span class="s2">]), </span><span class="s4">&quot;FacultyCode&quot;</span><span class="s2">] </span><span class="s3">= </span><span class="s4">&quot;SV&quot;</span>
<span class="s2">data.loc[data[</span><span class="s4">&quot;SectionCode&quot;</span><span class="s2">].isin([</span><span class="s4">&quot;MTE&quot;</span><span class="s2">, </span><span class="s4">&quot;IF&quot;</span><span class="s2">, </span><span class="s4">&quot;EDMT&quot;</span><span class="s2">, </span><span class="s4">&quot;EDFI&quot;</span><span class="s2">]), </span><span class="s4">&quot;FacultyCode&quot;</span><span class="s2">] </span><span class="s3">= </span><span class="s4">&quot;CDM&quot;</span>
<span class="s2">data.loc[data[</span><span class="s4">&quot;SectionCode&quot;</span><span class="s2">].isin([</span><span class="s4">&quot;SHS&quot;</span><span class="s2">, </span><span class="s4">&quot;DH&quot;</span><span class="s2">, </span><span class="s4">&quot;EDDH&quot;</span><span class="s2">]), </span><span class="s4">&quot;FacultyCode&quot;</span><span class="s2">] </span><span class="s3">= </span><span class="s4">&quot;CDH&quot;</span>
<span class="s2">data[</span><span class="s4">&quot;FacultyCode&quot;</span><span class="s2">] </span><span class="s3">= </span><span class="s2">data[</span><span class="s4">&quot;FacultyCode&quot;</span><span class="s2">].astype(</span><span class="s4">'category'</span><span class="s2">)</span>
<span class="s2">print(data[</span><span class="s4">&quot;FacultyCode&quot;</span><span class="s2">].cat.categories)</span>
<span class="s2">data[</span><span class="s4">&quot;FacultyCode&quot;</span><span class="s2">].cat.reorder_categories([</span><span class="s4">'STI'</span><span class="s2">, </span><span class="s4">'SB'</span><span class="s2">, </span><span class="s4">'IC'</span><span class="s2">, </span><span class="s4">'ENAC'</span><span class="s2">, </span><span class="s4">'SV'</span><span class="s2">, </span><span class="s4">'CDH'</span><span class="s2">, </span><span class="s4">'CDM'</span><span class="s2">], inplace</span><span class="s3">=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s2">data.to_csv(</span><span class="s4">f'./Output/</span><span class="s5">{</span><span class="s2">file_name</span><span class="s5">}</span><span class="s4">_cleaned.csv'</span><span class="s2">)</span>
<span class="s0">#%% md 
</span><span class="s2"># 3. Results 
### Most frequent concepts 
</span><span class="s0">#%% 
</span><span class="s2">coursesbyconcept </span><span class="s3">= </span><span class="s2">data.groupby(</span><span class="s4">&quot;PageTitle&quot;</span><span class="s2">).agg([</span><span class="s4">&quot;unique&quot;</span><span class="s2">, </span><span class="s4">&quot;nunique&quot;</span><span class="s2">])[</span><span class="s4">&quot;SubjectName&quot;</span><span class="s2">].sort_values(by</span><span class="s3">=</span><span class="s4">&quot;nunique&quot;</span><span class="s2">,</span>
                                                                                                   <span class="s2">ascending</span><span class="s3">=</span><span class="s1">False</span><span class="s2">)</span>
<span class="s2">coursesbyconcept.head()</span>
<span class="s0">#%% md 
</span><span class="s2">## 3.1 Curriculum 
### 3.1.1 Courses per curriculum level 
</span><span class="s0">#%% 
</span><span class="s2">countcourses </span><span class="s3">= </span><span class="s2">data.groupby(</span><span class="s4">&quot;StudyPlanLevelEN&quot;</span><span class="s2">)[</span><span class="s4">&quot;CourseCode&quot;</span><span class="s2">].agg([</span><span class="s4">&quot;nunique&quot;</span><span class="s2">])</span>
<span class="s2">countcourses</span>
<span class="s0">#%% 
</span><span class="s2">ax </span><span class="s3">= </span><span class="s2">sns.heatmap(countcourses.transpose(), annot</span><span class="s3">=</span><span class="s1">True</span><span class="s2">, cmap</span><span class="s3">=</span><span class="s4">&quot;YlGnBu&quot;</span><span class="s2">, annot_kws</span><span class="s3">=</span><span class="s2">{</span><span class="s4">&quot;size&quot;</span><span class="s3">: </span><span class="s5">12</span><span class="s2">},</span>
                 <span class="s2">fmt</span><span class="s3">=</span><span class="s4">'d'</span><span class="s2">);  </span><span class="s0">#, cbar_kws = dict(use_gridspec=False,location=&quot;top&quot;)</span>
<span class="s2">ax.set_title(</span><span class="s4">'Courses across curriculum level'</span><span class="s2">);</span>
<span class="s0">#%% md 
</span><span class="s2">### 3.1.2 Map courses over curriculum 
 
</span><span class="s0">#%% 
#list(data[&quot;StudyPlanLevelEN&quot;].cat.categories)</span>
<span class="s0">#values=data['CourseCode'], aggfunc=&quot;nunique&quot;,</span>
<span class="s2">ct_courses </span><span class="s3">= </span><span class="s2">pd.crosstab(index</span><span class="s3">=</span><span class="s2">data[</span><span class="s4">&quot;PageTitle&quot;</span><span class="s2">],</span>
                         <span class="s2">columns</span><span class="s3">=</span><span class="s2">data[</span><span class="s4">'StudyPlanLevelEN'</span><span class="s2">],</span>
                         <span class="s2">values</span><span class="s3">=</span><span class="s2">data[</span><span class="s4">'CourseCode'</span><span class="s2">], aggfunc</span><span class="s3">=</span><span class="s4">&quot;nunique&quot;</span><span class="s2">,</span>
                         <span class="s2">dropna</span><span class="s3">=</span><span class="s1">False</span><span class="s2">,</span>
                         <span class="s2">margins</span><span class="s3">=</span><span class="s1">True</span><span class="s2">)  </span><span class="s0">#.sort_values(by=[&quot;Master Cycle&quot;, &quot;Bachelor Cycle&quot;], ascending=False)</span>

<span class="s2">ct_courses.sort_values(by</span><span class="s3">=</span><span class="s4">&quot;All&quot;</span><span class="s2">, ascending</span><span class="s3">=</span><span class="s1">False</span><span class="s2">, inplace</span><span class="s3">=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">ct_courses.drop(</span><span class="s4">&quot;All&quot;</span><span class="s2">, axis</span><span class="s3">=</span><span class="s5">0</span><span class="s2">, inplace</span><span class="s3">=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">ct_courses.drop(</span><span class="s4">&quot;All&quot;</span><span class="s2">, axis</span><span class="s3">=</span><span class="s5">1</span><span class="s2">, inplace</span><span class="s3">=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s2">fig, ax </span><span class="s3">= </span><span class="s2">plt.subplots(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, figsize</span><span class="s3">=</span><span class="s2">(</span><span class="s5">10</span><span class="s2">, </span><span class="s5">60</span><span class="s2">))</span>

<span class="s2">ax </span><span class="s3">= </span><span class="s2">sns.heatmap(ct_courses, annot</span><span class="s3">=</span><span class="s1">True</span><span class="s2">, cmap</span><span class="s3">=</span><span class="s4">&quot;YlGnBu&quot;</span><span class="s2">, annot_kws</span><span class="s3">=</span><span class="s2">{</span><span class="s4">&quot;size&quot;</span><span class="s3">: </span><span class="s5">10</span><span class="s2">},</span>
                 <span class="s2">fmt</span><span class="s3">=</span><span class="s4">'d'</span><span class="s2">);  </span><span class="s0">#, cbar_kws = dict(use_gridspec=False,location=&quot;top&quot;)</span>

<span class="s2">ax.set_title(</span><span class="s4">'Courses across curriculum levels by concept'</span><span class="s2">)</span>
<span class="s2">ax.xaxis.tick_top()</span>
<span class="s2">ax.xaxis.set_label_position(</span><span class="s4">'top'</span><span class="s2">)</span>
<span class="s2">ax.tick_params(axis</span><span class="s3">=</span><span class="s4">u'both'</span><span class="s2">, which</span><span class="s3">=</span><span class="s4">u'both'</span><span class="s2">, length</span><span class="s3">=</span><span class="s5">0</span><span class="s2">)</span>

<span class="s2">plt.show()</span>
<span class="s0">#%% md 
</span><span class="s2">/!\ Computations are incorrect because it is computing a mean taking into account duplicate courses... 
ct_courses = pd.crosstab(index=data[&quot;PageTitle&quot;], 
                     columns=data['StudyPlanLevelEN'], 
                     values=data['Credits'], aggfunc=&quot;mean&quot;, 
                     dropna=False, margins=True)#.sort_values(by=[&quot;Master Cycle&quot;, &quot;Bachelor Cycle&quot;], ascending=False) 
 
ct_courses.sort_values(by=&quot;All&quot;, ascending=False, inplace=True) 
ct_courses.drop(&quot;All&quot;, axis=0, inplace=True) 
ct_courses.drop(&quot;All&quot;, axis=1, inplace=True) 
 
fig, ax =plt.subplots(1,1, figsize=(10,12)) 
 
ax = sns.heatmap(ct_courses, annot=True, cmap=&quot;YlGnBu&quot;, annot_kws={&quot;size&quot;: 10}, fmt='.2f'); #, cbar_kws = dict(use_gridspec=False,location=&quot;top&quot;) 
 
ax.set_title('Credits of courses (sum) across curriculum levels by concept') 
ax.xaxis.tick_top() 
ax.xaxis.set_label_position('top') 
ax.tick_params(axis=u'both', which=u'both',length=0) 
 
plt.show() 
</span><span class="s0">#%% 
</span><span class="s2">countteachers </span><span class="s3">= </span><span class="s2">data.groupby(</span><span class="s4">&quot;EMail&quot;</span><span class="s2">).agg([</span><span class="s4">&quot;unique&quot;</span><span class="s2">])[[</span><span class="s4">&quot;CourseCode&quot;</span><span class="s2">, </span><span class="s4">&quot;SubjectName&quot;</span><span class="s2">, </span><span class="s4">&quot;PageTitle&quot;</span><span class="s2">]]</span>
<span class="s2">countteachers.head()</span>
<span class="s0">#%% raw 
</span><span class="s2">countteachers.to_csv('ethics-list.csv') 
</span><span class="s0">#%% raw 
</span><span class="s2">data.loc[data[&quot;PageTitle&quot;]==&quot;Ethics&quot;, [&quot;CourseCode&quot;, &quot;CourseName&quot;]] 
</span><span class="s0">#%% md 
</span><span class="s2">## 3.2 Section / Faculty 
</span><span class="s0">#%% 
</span><span class="s2">countcourses </span><span class="s3">= </span><span class="s2">data.groupby(</span><span class="s4">&quot;SectionCode&quot;</span><span class="s2">)[</span><span class="s4">&quot;CourseCode&quot;</span><span class="s2">].agg([</span><span class="s4">&quot;nunique&quot;</span><span class="s2">]).sort_values(by</span><span class="s3">=</span><span class="s4">&quot;nunique&quot;</span><span class="s2">, ascending</span><span class="s3">=</span><span class="s1">False</span><span class="s2">)</span>
<span class="s2">countcourses.head()</span>
<span class="s0">#%% md 
</span><span class="s2">### 3.2.1 Courses across faculty by concept 
</span><span class="s0">#%% 
</span><span class="s2">ct_courses </span><span class="s3">= </span><span class="s2">pd.crosstab(index</span><span class="s3">=</span><span class="s2">data[</span><span class="s4">&quot;PageTitle&quot;</span><span class="s2">],</span>
                         <span class="s2">columns</span><span class="s3">=</span><span class="s2">data[</span><span class="s4">'FacultyCode'</span><span class="s2">],</span>
                         <span class="s2">values</span><span class="s3">=</span><span class="s2">data[</span><span class="s4">'CourseCode'</span><span class="s2">], aggfunc</span><span class="s3">=</span><span class="s4">&quot;nunique&quot;</span><span class="s2">,</span>
                         <span class="s2">dropna</span><span class="s3">=</span><span class="s1">False</span><span class="s2">, margins</span><span class="s3">=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s2">ct_courses.sort_values(by</span><span class="s3">=</span><span class="s4">&quot;All&quot;</span><span class="s2">, ascending</span><span class="s3">=</span><span class="s1">False</span><span class="s2">, inplace</span><span class="s3">=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">ct_courses.drop(</span><span class="s4">&quot;All&quot;</span><span class="s2">, axis</span><span class="s3">=</span><span class="s5">0</span><span class="s2">, inplace</span><span class="s3">=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">ct_courses.drop(</span><span class="s4">&quot;All&quot;</span><span class="s2">, axis</span><span class="s3">=</span><span class="s5">1</span><span class="s2">, inplace</span><span class="s3">=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s2">fig, ax </span><span class="s3">= </span><span class="s2">plt.subplots(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, figsize</span><span class="s3">=</span><span class="s2">(</span><span class="s5">10</span><span class="s2">, </span><span class="s5">60</span><span class="s2">))</span>

<span class="s2">ax </span><span class="s3">= </span><span class="s2">sns.heatmap(ct_courses, annot</span><span class="s3">=</span><span class="s1">True</span><span class="s2">, cmap</span><span class="s3">=</span><span class="s4">&quot;YlGnBu&quot;</span><span class="s2">, annot_kws</span><span class="s3">=</span><span class="s2">{</span><span class="s4">&quot;size&quot;</span><span class="s3">: </span><span class="s5">10</span><span class="s2">},</span>
                 <span class="s2">fmt</span><span class="s3">=</span><span class="s4">'d'</span><span class="s2">);  </span><span class="s0">#, cbar_kws = dict(use_gridspec=False,location=&quot;top&quot;)</span>

<span class="s2">ax.set_title(</span><span class="s4">'Courses across faculty by concept'</span><span class="s2">)</span>
<span class="s2">ax.xaxis.tick_top()</span>
<span class="s2">ax.xaxis.set_label_position(</span><span class="s4">'top'</span><span class="s2">)</span>
<span class="s2">ax.tick_params(axis</span><span class="s3">=</span><span class="s4">u'both'</span><span class="s2">, which</span><span class="s3">=</span><span class="s4">u'both'</span><span class="s2">, length</span><span class="s3">=</span><span class="s5">0</span><span class="s2">)</span>

<span class="s2">plt.show()</span>
<span class="s0">#%% md 
</span><span class="s2">### Extract most frequent unique concepts 
</span><span class="s0">#%% 
</span><span class="s2">countcourses </span><span class="s3">= </span><span class="s2">data.groupby(</span><span class="s4">&quot;PageTitle&quot;</span><span class="s2">)[</span><span class="s4">&quot;CourseCode&quot;</span><span class="s2">].agg([</span><span class="s4">&quot;nunique&quot;</span><span class="s2">]).sort_values(by</span><span class="s3">=</span><span class="s4">&quot;nunique&quot;</span><span class="s2">, ascending</span><span class="s3">=</span><span class="s1">False</span><span class="s2">)</span>
<span class="s2">countcourses.head(</span><span class="s5">10</span><span class="s2">)</span>
<span class="s0">#%% md 
</span><span class="s2">## 3.3 Map by factulty and curriculum levelx 
</span><span class="s0">#%% 
</span><span class="s2">ct_courses_N </span><span class="s3">= </span><span class="s2">pd.crosstab(index</span><span class="s3">=</span><span class="s2">data[</span><span class="s4">'FacultyCode'</span><span class="s2">],</span>
                           <span class="s2">columns</span><span class="s3">=</span><span class="s2">data[</span><span class="s4">'StudyPlanLevelEN'</span><span class="s2">],</span>
                           <span class="s2">values</span><span class="s3">=</span><span class="s2">data[</span><span class="s4">'CourseCode'</span><span class="s2">], aggfunc</span><span class="s3">=</span><span class="s4">&quot;nunique&quot;</span><span class="s2">,</span>
                           <span class="s2">dropna</span><span class="s3">=</span><span class="s1">False</span><span class="s2">, margins</span><span class="s3">=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s0">#ct_courses.sort_values(by=&quot;All&quot;, ascending=False, inplace=True)</span>
<span class="s2">ct_courses_N.drop(</span><span class="s4">&quot;All&quot;</span><span class="s2">, axis</span><span class="s3">=</span><span class="s5">0</span><span class="s2">, inplace</span><span class="s3">=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">ct_courses_N.drop(</span><span class="s4">&quot;All&quot;</span><span class="s2">, axis</span><span class="s3">=</span><span class="s5">1</span><span class="s2">, inplace</span><span class="s3">=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s2">fig, ax </span><span class="s3">= </span><span class="s2">plt.subplots(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, figsize</span><span class="s3">=</span><span class="s2">(</span><span class="s5">10</span><span class="s2">, </span><span class="s5">8</span><span class="s2">))</span>

<span class="s2">ax </span><span class="s3">= </span><span class="s2">sns.heatmap(ct_courses_N, annot</span><span class="s3">=</span><span class="s1">True</span><span class="s2">, cmap</span><span class="s3">=</span><span class="s4">&quot;YlGnBu&quot;</span><span class="s2">, annot_kws</span><span class="s3">=</span><span class="s2">{</span><span class="s4">&quot;size&quot;</span><span class="s3">: </span><span class="s5">10</span><span class="s2">},</span>
                 <span class="s2">fmt</span><span class="s3">=</span><span class="s4">'g'</span><span class="s2">);  </span><span class="s0">#, vmax=40, cbar_kws = dict(use_gridspec=False,location=&quot;top&quot;)</span>

<span class="s2">ax.set_title(</span><span class="s4">'Number of courses'</span><span class="s2">)</span>
<span class="s2">ax.xaxis.tick_top()</span>
<span class="s2">ax.xaxis.set_label_position(</span><span class="s4">'top'</span><span class="s2">)</span>
<span class="s2">ax.tick_params(axis</span><span class="s3">=</span><span class="s4">u'both'</span><span class="s2">, which</span><span class="s3">=</span><span class="s4">u'both'</span><span class="s2">, length</span><span class="s3">=</span><span class="s5">0</span><span class="s2">)</span>

<span class="s2">plt.show()</span>
<span class="s0">#%% raw 
</span><span class="s2">#### /!\ Computations are incorrect because it is computing a mean taking into account duplicate courses... 
ct_courses_C = pd.crosstab(index=data['FacultyCode'],  
                     columns=data['StudyPlanLevelEN'], 
                     values=data['Credits'], aggfunc=&quot;mean&quot;, 
                     dropna=False, margins=True).round(2) 
 
ct_courses_C.drop(&quot;All&quot;, axis=0, inplace=True) 
ct_courses_C.drop(&quot;All&quot;, axis=1, inplace=True) 
 
fig, ax =plt.subplots(1,1, figsize=(10,8)) 
 
ax = sns.heatmap(ct_courses_C, annot=True, cmap=&quot;YlGnBu&quot;, annot_kws={&quot;size&quot;: 10}, fmt='g'); #, vmax=40, cbar_kws = dict(use_gridspec=False,location=&quot;top&quot;) 
 
ax.set_title('Average credits of courses') 
ax.xaxis.tick_top() 
ax.xaxis.set_label_position('top') 
ax.tick_params(axis=u'both', which=u'both',length=0) 
 
plt.show() 
</span><span class="s0">#%% 
# ISSUE - we have duplicate courses!</span>
<span class="s0"># Some courses are offered at several levels, which we have to keep</span>
<span class="s0"># But we have to remove the duplicates due to other factors (concepts and lecturers mainly)</span>

<span class="s2">ct_courses_CN1 </span><span class="s3">= </span><span class="s2">pd.crosstab(index</span><span class="s3">=</span><span class="s2">data[</span><span class="s4">'FacultyCode'</span><span class="s2">],</span>
                             <span class="s2">columns</span><span class="s3">=</span><span class="s2">data[</span><span class="s4">'StudyPlanLevelEN'</span><span class="s2">],</span>
                             <span class="s2">values</span><span class="s3">=</span><span class="s2">data[</span><span class="s4">'CourseCode'</span><span class="s2">], aggfunc</span><span class="s3">=</span><span class="s4">&quot;nunique&quot;</span><span class="s2">,</span>
                             <span class="s2">dropna</span><span class="s3">=</span><span class="s1">False</span><span class="s2">, margins</span><span class="s3">=</span><span class="s1">True</span><span class="s2">).round(</span><span class="s5">2</span><span class="s2">)</span>

<span class="s0"># First we remove the duplicates taking into account the level in the study plan</span>
<span class="s2">data_unique </span><span class="s3">= </span><span class="s2">data.drop_duplicates(subset</span><span class="s3">=</span><span class="s2">[</span><span class="s4">&quot;CourseCode&quot;</span><span class="s2">, </span><span class="s4">&quot;StudyPlanLevelEN&quot;</span><span class="s2">])</span>
<span class="s0"># Then we average the credits</span>
<span class="s2">ct_courses_CN2 </span><span class="s3">= </span><span class="s2">pd.crosstab(index</span><span class="s3">=</span><span class="s2">data_unique[</span><span class="s4">'FacultyCode'</span><span class="s2">],</span>
                             <span class="s2">columns</span><span class="s3">=</span><span class="s2">data_unique[</span><span class="s4">'StudyPlanLevelEN'</span><span class="s2">],</span>
                             <span class="s2">values</span><span class="s3">=</span><span class="s2">data_unique[</span><span class="s4">'Credits'</span><span class="s2">], aggfunc</span><span class="s3">=</span><span class="s4">&quot;mean&quot;</span><span class="s2">,</span>
                             <span class="s2">dropna</span><span class="s3">=</span><span class="s1">False</span><span class="s2">, margins</span><span class="s3">=</span><span class="s1">True</span><span class="s2">).round(</span><span class="s5">2</span><span class="s2">)</span>

<span class="s2">ct_courses_CN </span><span class="s3">= </span><span class="s2">pd.concat([ct_courses_CN1, ct_courses_CN2], axis</span><span class="s3">=</span><span class="s5">1</span><span class="s2">, keys</span><span class="s3">=</span><span class="s2">[</span><span class="s4">&quot;count&quot;</span><span class="s2">, </span><span class="s4">&quot;mean&quot;</span><span class="s2">])</span>

<span class="s0"># Pretty labels for rows and columns</span>
<span class="s2">ct_courses_CN.rename(columns</span><span class="s3">=</span><span class="s2">{</span><span class="s4">'count'</span><span class="s3">: </span><span class="s4">'Number of unique courses'</span><span class="s2">, </span><span class="s4">'mean'</span><span class="s3">: </span><span class="s4">'Average number of credits'</span><span class="s2">}, inplace</span><span class="s3">=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">ct_courses_CN.rename_axis(columns</span><span class="s3">=</span><span class="s2">{</span><span class="s4">'StudyPlanLevelEN'</span><span class="s3">: </span><span class="s4">'Level of study plan'</span><span class="s2">}, inplace</span><span class="s3">=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">ct_courses_CN.rename_axis(index</span><span class="s3">=</span><span class="s2">{</span><span class="s4">'FacultyCode'</span><span class="s3">: </span><span class="s4">'Faculty'</span><span class="s2">}, inplace</span><span class="s3">=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s0"># Orange color palette for number of courses</span>
<span class="s2">orange </span><span class="s3">= </span><span class="s2">sns.color_palette(</span><span class="s4">&quot;YlOrBr&quot;</span><span class="s2">, as_cmap</span><span class="s3">=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s0"># Blue color palette for average credits, with white for NaN values</span>
<span class="s2">blue </span><span class="s3">= </span><span class="s2">sns.color_palette(</span><span class="s4">&quot;Blues&quot;</span><span class="s2">, as_cmap</span><span class="s3">=</span><span class="s1">True</span><span class="s2">).copy()</span>
<span class="s2">blue.set_bad(color</span><span class="s3">=</span><span class="s4">'white'</span><span class="s2">)</span>

<span class="s0"># getting the list of rows in the crosstab</span>
<span class="s2">rows </span><span class="s3">= </span><span class="s2">ct_courses_CN.index.get_level_values(</span><span class="s5">0</span><span class="s2">)</span>
<span class="s0"># getting the list of second level colunms (which are duplicate)</span>
<span class="s2">cols0 </span><span class="s3">= </span><span class="s2">ct_courses_CN.columns.get_level_values(</span><span class="s5">0</span><span class="s2">).unique()</span>
<span class="s0"># getting the list of second level colunms (which are duplicate)</span>
<span class="s2">cols1 </span><span class="s3">= </span><span class="s2">ct_courses_CN.columns.get_level_values(</span><span class="s5">1</span><span class="s2">).unique()</span>

<span class="s0"># Getting rid of unecessary numbers</span>
<span class="s2">pd.set_option(</span><span class="s4">'precision'</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>

<span class="s0"># Styling the table</span>
<span class="s2">ct_courses_CN.style.set_table_styles([dict(selector</span><span class="s3">=</span><span class="s4">'th'</span><span class="s2">, props</span><span class="s3">=</span><span class="s2">[(</span><span class="s4">'text-align'</span><span class="s2">, </span><span class="s4">'left'</span><span class="s2">)])])</span>
<span class="s2">.background_gradient(subset</span><span class="s3">=</span><span class="s2">pd.IndexSlice[rows[</span><span class="s3">:-</span><span class="s5">1</span><span class="s2">], pd.IndexSlice[cols0[</span><span class="s5">0</span><span class="s2">], cols1[</span><span class="s3">:-</span><span class="s5">1</span><span class="s2">]]], cmap</span><span class="s3">=</span><span class="s2">orange, vmax</span><span class="s3">=</span><span class="s5">100</span><span class="s2">)</span>
<span class="s2">.background_gradient(subset</span><span class="s3">=</span><span class="s2">pd.IndexSlice[rows[</span><span class="s3">:-</span><span class="s5">1</span><span class="s2">], pd.IndexSlice[cols0[</span><span class="s5">1</span><span class="s2">], cols1[</span><span class="s3">:-</span><span class="s5">1</span><span class="s2">]]], cmap</span><span class="s3">=</span><span class="s2">blue, vmax</span><span class="s3">=</span><span class="s5">6</span><span class="s2">)</span>
<span class="s0">#%% 
</span><span class="s2">ct_courses_C </span><span class="s3">= </span><span class="s2">pd.crosstab(index</span><span class="s3">=</span><span class="s2">data_unique[</span><span class="s4">'FacultyCode'</span><span class="s2">],</span>
                           <span class="s2">columns</span><span class="s3">=</span><span class="s2">data_unique[</span><span class="s4">'StudyPlanLevelEN'</span><span class="s2">],</span>
                           <span class="s2">values</span><span class="s3">=</span><span class="s2">data_unique[</span><span class="s4">'Credits'</span><span class="s2">], aggfunc</span><span class="s3">=</span><span class="s4">&quot;mean&quot;</span><span class="s2">,</span>
                           <span class="s2">dropna</span><span class="s3">=</span><span class="s1">False</span><span class="s2">, margins</span><span class="s3">=</span><span class="s1">True</span><span class="s2">).round(</span><span class="s5">2</span><span class="s2">)</span>

<span class="s2">ct_courses_C.drop(</span><span class="s4">&quot;All&quot;</span><span class="s2">, axis</span><span class="s3">=</span><span class="s5">0</span><span class="s2">, inplace</span><span class="s3">=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">ct_courses_C.drop(</span><span class="s4">&quot;All&quot;</span><span class="s2">, axis</span><span class="s3">=</span><span class="s5">1</span><span class="s2">, inplace</span><span class="s3">=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s2">fig, ax </span><span class="s3">= </span><span class="s2">plt.subplots(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, figsize</span><span class="s3">=</span><span class="s2">(</span><span class="s5">10</span><span class="s2">, </span><span class="s5">8</span><span class="s2">))</span>

<span class="s2">ax </span><span class="s3">= </span><span class="s2">sns.heatmap(ct_courses_C, annot</span><span class="s3">=</span><span class="s1">True</span><span class="s2">, cmap</span><span class="s3">=</span><span class="s4">&quot;YlGnBu&quot;</span><span class="s2">, annot_kws</span><span class="s3">=</span><span class="s2">{</span><span class="s4">&quot;size&quot;</span><span class="s3">: </span><span class="s5">10</span><span class="s2">},</span>
                 <span class="s2">fmt</span><span class="s3">=</span><span class="s4">'g'</span><span class="s2">);  </span><span class="s0">#, vmax=40, cbar_kws = dict(use_gridspec=False,location=&quot;top&quot;)</span>

<span class="s2">ax.set_title(</span><span class="s4">'Average credits of courses'</span><span class="s2">)</span>
<span class="s2">ax.xaxis.tick_top()</span>
<span class="s2">ax.xaxis.set_label_position(</span><span class="s4">'top'</span><span class="s2">)</span>
<span class="s2">ax.tick_params(axis</span><span class="s3">=</span><span class="s4">u'both'</span><span class="s2">, which</span><span class="s3">=</span><span class="s4">u'both'</span><span class="s2">, length</span><span class="s3">=</span><span class="s5">0</span><span class="s2">)</span>

<span class="s2">plt.show()</span>
<span class="s0">#%% raw 
</span><span class="s2"># Shorter way1 of doing the same thing, but issue with the average credits, because of the duplicate courses 
# Option 1 with crosstab: 
ct_courses_CN = pd.crosstab(index=data_unique['FacultyCode'],  
                     columns=data_unique['StudyPlanLevelEN'], 
                     values=data_unique['Credits'], aggfunc=[&quot;count&quot;, &quot;mean&quot;], 
                     dropna=False, margins=True).round(2)  
 
# Option 2 with groupby 
df1 = (data.groupby(['FacultyCode','StudyPlanLevelEN']) 
         .agg({'CourseCode':'count','Credits':'mean'}) 
         .unstack()) 
df1 
</span><span class="s0">#%% 
</span><span class="s2">data.loc[(data[</span><span class="s4">&quot;FacultyCode&quot;</span><span class="s2">].isin([</span><span class="s4">&quot;CDH&quot;</span><span class="s2">])) </span><span class="s3">&amp; </span><span class="s2">(data[</span><span class="s4">&quot;StudyPlanLevelEN&quot;</span><span class="s2">].isin([</span><span class="s4">&quot;Doctoral School&quot;</span><span class="s2">]))].drop_duplicates(</span>
    <span class="s2">subset</span><span class="s3">=</span><span class="s2">[</span><span class="s4">&quot;CourseCode&quot;</span><span class="s2">, </span><span class="s4">'StudyPlanLevelEN'</span><span class="s2">])</span>
<span class="s0">#%% raw 
</span><span class="s2">databigcredits = data.loc[data['Credits'] &gt;= 6] 
ct_courses_CN = pd.crosstab(index=databigcredits['FacultyCode'],  
                     columns=databigcredits['StudyPlanLevelEN'], 
                     values=databigcredits['Credits'], aggfunc=[&quot;count&quot;, &quot;mean&quot;], 
                     dropna=False, margins=True).round(2) 
ct_courses_CN 
</span><span class="s0">#%% 
</span><span class="s2">data.loc[</span>
    <span class="s2">(data[</span><span class="s4">'Credits'</span><span class="s2">] </span><span class="s3">&gt;= </span><span class="s5">6</span><span class="s2">) </span><span class="s3">&amp; </span><span class="s2">(data[</span><span class="s4">&quot;FacultyCode&quot;</span><span class="s2">].isin([</span><span class="s4">&quot;STI&quot;</span><span class="s2">])) </span><span class="s3">&amp; </span><span class="s2">(data[</span><span class="s4">&quot;StudyPlanLevelEN&quot;</span><span class="s2">].isin([</span><span class="s4">&quot;Propedeutics&quot;</span><span class="s2">]))]</span>
<span class="s2">.drop_duplicates(subset</span><span class="s3">=</span><span class="s2">[</span><span class="s4">&quot;CourseCode&quot;</span><span class="s2">, </span><span class="s4">'StudyPlanLevelEN'</span><span class="s2">])</span>
<span class="s0">#%% 
</span><span class="s2">data.loc[(data[</span><span class="s4">'Credits'</span><span class="s2">] </span><span class="s3">&gt;= </span><span class="s5">6</span><span class="s2">) </span><span class="s3">&amp; </span><span class="s2">(data[</span><span class="s4">&quot;FacultyCode&quot;</span><span class="s2">].isin([</span><span class="s4">&quot;IC&quot;</span><span class="s2">])) </span><span class="s3">&amp; </span><span class="s2">(</span>
    <span class="s2">data[</span><span class="s4">&quot;StudyPlanLevelEN&quot;</span><span class="s2">].isin([</span><span class="s4">&quot;Propedeutics&quot;</span><span class="s2">]))].drop_duplicates(subset</span><span class="s3">=</span><span class="s2">[</span><span class="s4">&quot;CourseCode&quot;</span><span class="s2">])</span>
<span class="s0">#%% 
</span><span class="s2">data.loc[(data[</span><span class="s4">'Credits'</span><span class="s2">] </span><span class="s3">&gt;= </span><span class="s5">6</span><span class="s2">) </span><span class="s3">&amp; </span><span class="s2">(data[</span><span class="s4">&quot;FacultyCode&quot;</span><span class="s2">].isin([</span><span class="s4">&quot;STI&quot;</span><span class="s2">])) </span><span class="s3">&amp; </span><span class="s2">(</span>
    <span class="s2">data[</span><span class="s4">&quot;StudyPlanLevelEN&quot;</span><span class="s2">].isin([</span><span class="s4">&quot;Propedeutics&quot;</span><span class="s2">]))].drop_duplicates(subset</span><span class="s3">=</span><span class="s2">[</span><span class="s4">&quot;CourseCode&quot;</span><span class="s2">])</span>
<span class="s0">#%% 
</span><span class="s2">data.loc[(data[</span><span class="s4">'Credits'</span><span class="s2">] </span><span class="s3">&gt;= </span><span class="s5">6</span><span class="s2">) </span><span class="s3">&amp; </span><span class="s2">(data[</span><span class="s4">&quot;FacultyCode&quot;</span><span class="s2">].isin([</span><span class="s4">&quot;CDM&quot;</span><span class="s2">])) </span><span class="s3">&amp; </span><span class="s2">(</span>
    <span class="s2">data[</span><span class="s4">&quot;StudyPlanLevelEN&quot;</span><span class="s2">].isin([</span><span class="s4">&quot;Master Cycle&quot;</span><span class="s2">]))].drop_duplicates(subset</span><span class="s3">=</span><span class="s2">[</span><span class="s4">&quot;CourseCode&quot;</span><span class="s2">]).sort_values(</span>
    <span class="s2">by</span><span class="s3">=</span><span class="s4">&quot;FacultyCode&quot;</span><span class="s2">)</span>
<span class="s0">#%% 
</span><span class="s2">data.loc[(data[</span><span class="s4">'Credits'</span><span class="s2">] </span><span class="s3">&gt;= </span><span class="s5">6</span><span class="s2">) </span><span class="s3">&amp; </span><span class="s2">(data[</span><span class="s4">&quot;FacultyCode&quot;</span><span class="s2">].isin([</span><span class="s4">&quot;SV&quot;</span><span class="s2">]))].drop_duplicates(subset</span><span class="s3">=</span><span class="s2">[</span><span class="s4">&quot;CourseCode&quot;</span><span class="s2">])</span>
<span class="s0">#%% 
</span><span class="s2">data[(data[</span><span class="s4">&quot;StudyPlanLevelEN&quot;</span><span class="s2">] </span><span class="s3">== </span><span class="s4">&quot;Propedeutics&quot;</span><span class="s2">) </span><span class="s3">&amp; </span><span class="s2">(data[</span><span class="s4">&quot;FacultyCode&quot;</span><span class="s2">] </span><span class="s3">== </span><span class="s4">&quot;STI&quot;</span><span class="s2">)]</span>
<span class="s0">#%% 
</span><span class="s2">data.loc[(data[</span><span class="s4">'Credits'</span><span class="s2">] </span><span class="s3">&gt;= </span><span class="s5">8</span><span class="s2">)].drop_duplicates(subset</span><span class="s3">=</span><span class="s2">[</span><span class="s4">&quot;CourseCode&quot;</span><span class="s2">])</span>
<span class="s0">#%% 
</span><span class="s2">data[data[</span><span class="s4">&quot;CourseCode&quot;</span><span class="s2">] </span><span class="s3">== </span><span class="s4">&quot;MICRO-428&quot;</span><span class="s2">]</span>
<span class="s0">#%% 
</span><span class="s2">data[(data[</span><span class="s4">&quot;StudyPlanLevelEN&quot;</span><span class="s2">] </span><span class="s3">== </span><span class="s4">&quot;Propedeutics&quot;</span><span class="s2">) </span><span class="s3">&amp; </span><span class="s2">(data[</span><span class="s4">&quot;FacultyCode&quot;</span><span class="s2">] </span><span class="s3">== </span><span class="s4">&quot;CDH&quot;</span><span class="s2">)]</span>
<span class="s0">#%% md 
</span><span class="s2">## 3.4 Categories &amp; Themes of concepts 
</span><span class="s0">#%% 
</span><span class="s2">concepts_df </span><span class="s3">= </span><span class="s2">pd.read_json(</span><span class="s4">&quot;Input/planetary_boundaries_social_keywords.json&quot;</span><span class="s2">).explode(</span><span class="s4">&quot;Key words&quot;</span><span class="s2">)</span>
<span class="s2">concepts_df.head()</span>
<span class="s0">#%% 
</span><span class="s2">concepts_df[</span><span class="s4">&quot;Key words&quot;</span><span class="s2">] </span><span class="s3">= </span><span class="s2">concepts_df[</span><span class="s4">&quot;Key words&quot;</span><span class="s2">].apply(</span><span class="s1">lambda </span><span class="s2">keyword</span><span class="s3">: </span><span class="s2">keyword[</span><span class="s5">0</span><span class="s2">].upper() </span><span class="s3">+ </span><span class="s2">keyword[</span><span class="s5">1</span><span class="s3">:</span><span class="s2">])</span>
<span class="s0">#%% 
</span><span class="s2">categorical_data </span><span class="s3">= </span><span class="s2">data.merge(concepts_df, left_on</span><span class="s3">=</span><span class="s4">&quot;PageTitle&quot;</span><span class="s2">, right_on</span><span class="s3">=</span><span class="s4">&quot;Key words&quot;</span><span class="s2">, how</span><span class="s3">=</span><span class="s4">&quot;left&quot;</span><span class="s2">)</span>
<span class="s0">#%% 
</span><span class="s2">planetary_boundaries </span><span class="s3">= </span><span class="s2">[</span><span class="s4">&quot;Energy, Climate change and ocean acidificatoin&quot;</span><span class="s2">, </span><span class="s4">&quot;Novel entities and atmospheric loading&quot;</span><span class="s2">,</span>
                        <span class="s4">&quot;Biochemical cycles&quot;</span><span class="s2">, </span><span class="s4">&quot;Water&quot;</span><span class="s2">, </span><span class="s4">&quot;Land-system change&quot;</span><span class="s2">, </span><span class="s4">&quot;Biodiversity integrity&quot;</span><span class="s2">,</span>
                        <span class="s4">&quot;Materials and Metals&quot;</span><span class="s2">]</span>
<span class="s2">social_foundations </span><span class="s3">= </span><span class="s2">[</span><span class="s4">&quot;Food and Health&quot;</span><span class="s2">, </span><span class="s4">&quot;Social values and culture&quot;</span><span class="s2">,</span>
                      <span class="s4">&quot;Transversal skills, Communication and imaginaries&quot;</span><span class="s2">, </span><span class="s4">&quot;Industries, technologies and conception&quot;</span><span class="s2">,</span>
                      <span class="s4">&quot;Governance,  Economy and Politics&quot;</span><span class="s2">]</span>
<span class="s0">#%% 
</span><span class="s2">countcourses </span><span class="s3">= </span><span class="s2">categorical_data.groupby(</span><span class="s4">&quot;Theme&quot;</span><span class="s2">)[</span><span class="s4">&quot;CourseCode&quot;</span><span class="s2">].agg([</span><span class="s4">&quot;nunique&quot;</span><span class="s2">])</span>
<span class="s2">countcourses</span>
<span class="s0">#%% md 
</span>
<span class="s0">#%% md 
</span><span class="s2">### 3.4.1 Unique courses per planetary boundary theme 
</span><span class="s0">#%% 
</span><span class="s2">ax </span><span class="s3">= </span><span class="s2">sns.heatmap(countcourses.loc[planetary_boundaries].sort_values(by</span><span class="s3">=</span><span class="s4">&quot;nunique&quot;</span><span class="s2">, ascending</span><span class="s3">=</span><span class="s1">False</span><span class="s2">), annot</span><span class="s3">=</span><span class="s1">True</span><span class="s2">,</span>
                 <span class="s2">cmap</span><span class="s3">=</span><span class="s4">&quot;YlGnBu&quot;</span><span class="s2">, annot_kws</span><span class="s3">=</span><span class="s2">{</span><span class="s4">&quot;size&quot;</span><span class="s3">: </span><span class="s5">12</span><span class="s2">}, fmt</span><span class="s3">=</span><span class="s4">'d'</span><span class="s2">);  </span><span class="s0">#, cbar_kws = dict(use_gridspec=False,location=&quot;top&quot;)</span>
<span class="s2">ax.set_title(</span><span class="s4">'Unique courses covering planetary boundary themes'</span><span class="s2">);</span>
<span class="s0">#%% md 
</span><span class="s2">### 3.4.2 Unique courses per Social foundations, perspectives and sectorial approaches 
</span><span class="s0">#%% 
</span><span class="s2">ax </span><span class="s3">= </span><span class="s2">sns.heatmap(countcourses.loc[social_foundations].sort_values(by</span><span class="s3">=</span><span class="s4">&quot;nunique&quot;</span><span class="s2">, ascending</span><span class="s3">=</span><span class="s1">False</span><span class="s2">), annot</span><span class="s3">=</span><span class="s1">True</span><span class="s2">,</span>
                 <span class="s2">cmap</span><span class="s3">=</span><span class="s4">&quot;YlGnBu&quot;</span><span class="s2">, annot_kws</span><span class="s3">=</span><span class="s2">{</span><span class="s4">&quot;size&quot;</span><span class="s3">: </span><span class="s5">12</span><span class="s2">}, fmt</span><span class="s3">=</span><span class="s4">'d'</span><span class="s2">);  </span><span class="s0">#, cbar_kws = dict(use_gridspec=False,location=&quot;top&quot;)</span>
<span class="s2">ax.set_title(</span><span class="s4">'Unique courses covering social foundation themes'</span><span class="s2">);</span>
<span class="s0">#%% md 
</span><span class="s2">### 3.4.3 Distribution of unique concepts by course and by Theme 
</span><span class="s0">#%% md 
</span>
<span class="s0">#%% 
</span><span class="s2">grouped </span><span class="s3">= </span><span class="s2">data.groupby([</span><span class="s4">'CourseCode'</span><span class="s2">, </span><span class="s4">'SubjectName'</span><span class="s2">]).agg([</span><span class="s4">'unique'</span><span class="s2">, </span><span class="s4">'nunique'</span><span class="s2">])[</span><span class="s4">'PageTitle'</span><span class="s2">].sort_values(by</span><span class="s3">=</span><span class="s4">&quot;nunique&quot;</span><span class="s2">,</span>
                                                                                                          <span class="s2">ascending</span><span class="s3">=</span><span class="s1">False</span><span class="s2">).reset_index().set_index(</span>
    <span class="s4">'CourseCode'</span><span class="s2">)</span>
<span class="s2">px.bar(grouped, y</span><span class="s3">=</span><span class="s4">'nunique'</span><span class="s2">, hover_data</span><span class="s3">=</span><span class="s2">[</span><span class="s4">'SubjectName'</span><span class="s2">, </span><span class="s4">'unique'</span><span class="s2">], title</span><span class="s3">=</span><span class="s4">'Overall distribution of unique concepts by course'</span><span class="s2">)</span>
<span class="s0">#%% 
</span><span class="s2">boundaries_data </span><span class="s3">= </span><span class="s2">categorical_data[categorical_data[</span><span class="s4">&quot;Categories&quot;</span><span class="s2">] </span><span class="s3">== </span><span class="s4">'Planetary boundaries'</span><span class="s2">]</span>

<span class="s2">boundaries_data </span><span class="s3">= </span><span class="s2">boundaries_data.groupby([</span><span class="s4">'CourseCode'</span><span class="s2">, </span><span class="s4">'Theme'</span><span class="s2">, </span><span class="s4">'SubjectName'</span><span class="s2">]).agg([</span><span class="s4">'unique'</span><span class="s2">, </span><span class="s4">'nunique'</span><span class="s2">])[</span><span class="s4">'PageTitle'</span><span class="s2">].sort_values(by</span><span class="s3">=</span><span class="s4">&quot;nunique&quot;</span><span class="s2">,ascending</span><span class="s3">=</span><span class="s1">False</span><span class="s2">).reset_index().set_index(</span><span class="s4">'CourseCode'</span><span class="s2">)</span>

<span class="s2">fig </span><span class="s3">= </span><span class="s2">px.bar(boundaries_data, y</span><span class="s3">=</span><span class="s4">'nunique'</span><span class="s2">, facet_col</span><span class="s3">=</span><span class="s4">'Theme'</span><span class="s2">, facet_col_wrap</span><span class="s3">=</span><span class="s5">2</span><span class="s2">, hover_data</span><span class="s3">=</span><span class="s2">[</span><span class="s4">'SubjectName'</span><span class="s2">, </span><span class="s4">'unique'</span><span class="s2">], title</span><span class="s3">=</span><span class="s4">'Distribution of unique concepts by course, for platenary boundary themes'</span><span class="s2">, height</span><span class="s3">=</span><span class="s5">800</span><span class="s2">)</span>

<span class="s2">fig.update_xaxes(matches</span><span class="s3">=</span><span class="s1">None</span><span class="s2">)</span>
<span class="s2">fig.update_yaxes(matches</span><span class="s3">=</span><span class="s1">None</span><span class="s2">)</span>
<span class="s2">fig.show()</span>

<span class="s0">#%% 
</span><span class="s2">foundations_data </span><span class="s3">= </span><span class="s2">categorical_data[categorical_data[</span><span class="s4">&quot;Categories&quot;</span><span class="s2">] </span><span class="s3">== </span><span class="s4">'Social foundations, perspectives and sectorial approaches'</span><span class="s2">]</span>
<span class="s2">foundations_data </span><span class="s3">= </span><span class="s2">foundations_data.groupby([</span><span class="s4">'CourseCode'</span><span class="s2">, </span><span class="s4">'Theme'</span><span class="s2">, </span><span class="s4">'SubjectName'</span><span class="s2">]).agg([</span><span class="s4">'unique'</span><span class="s2">, </span><span class="s4">'nunique'</span><span class="s2">])[</span><span class="s4">'PageTitle'</span><span class="s2">].sort_values(by</span><span class="s3">=</span><span class="s4">&quot;nunique&quot;</span><span class="s2">,ascending</span><span class="s3">=</span><span class="s1">False</span><span class="s2">).reset_index().set_index(</span><span class="s4">'CourseCode'</span><span class="s2">)</span>

<span class="s2">fig </span><span class="s3">= </span><span class="s2">px.bar(foundations_data, y</span><span class="s3">=</span><span class="s4">'nunique'</span><span class="s2">, facet_col</span><span class="s3">=</span><span class="s4">'Theme'</span><span class="s2">, facet_col_wrap</span><span class="s3">=</span><span class="s5">2</span><span class="s2">, hover_data</span><span class="s3">=</span><span class="s2">[</span><span class="s4">'SubjectName'</span><span class="s2">, </span><span class="s4">'unique'</span><span class="s2">], title</span><span class="s3">=</span><span class="s4">'Distribution of unique concepts by course, for platenary boundary themes'</span><span class="s2">, height</span><span class="s3">=</span><span class="s5">800</span><span class="s2">)</span>

<span class="s2">fig.update_xaxes(matches</span><span class="s3">=</span><span class="s1">None</span><span class="s2">)</span>
<span class="s2">fig.update_yaxes(matches</span><span class="s3">=</span><span class="s1">None</span><span class="s2">)</span>
<span class="s2">fig.show()</span>

<span class="s0">#%% 
</span><span class="s2">categorical_data.groupby([</span><span class="s4">'FacultyCode'</span><span class="s2">, </span><span class="s4">'CourseCode'</span><span class="s2">]).agg([</span><span class="s4">'nunique'</span><span class="s2">])[</span><span class="s4">'PageTitle'</span><span class="s2">].sort_values(by</span><span class="s3">=</span><span class="s4">&quot;nunique&quot;</span><span class="s2">,</span>
                                                                                                  <span class="s2">ascending</span><span class="s3">=</span><span class="s1">False</span><span class="s2">).groupby(</span>
    <span class="s4">'FacultyCode'</span><span class="s2">).sum()</span>
<span class="s0">#%% 
</span><span class="s2">boundaries_data </span><span class="s3">= </span><span class="s2">categorical_data[categorical_data[</span><span class="s4">&quot;Theme&quot;</span><span class="s2">].isin(planetary_boundaries)]</span>
<span class="s2">ct_courses_boundaries </span><span class="s3">= </span><span class="s2">pd.crosstab(index</span><span class="s3">=</span><span class="s2">boundaries_data[</span><span class="s4">'FacultyCode'</span><span class="s2">],</span>
                                    <span class="s2">columns</span><span class="s3">=</span><span class="s2">boundaries_data[</span><span class="s4">'Theme'</span><span class="s2">],</span>
                                    <span class="s2">values</span><span class="s3">=</span><span class="s2">boundaries_data[</span><span class="s4">'CourseCode'</span><span class="s2">], aggfunc</span><span class="s3">=</span><span class="s4">&quot;nunique&quot;</span><span class="s2">,</span>
                                    <span class="s2">dropna</span><span class="s3">=</span><span class="s1">False</span><span class="s2">, margins</span><span class="s3">=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s2">ct_courses_boundaries </span><span class="s3">= </span><span class="s2">ct_courses_boundaries.loc[ct_courses_boundaries.mean(axis</span><span class="s3">=</span><span class="s5">1</span><span class="s2">).sort_values(ascending</span><span class="s3">=</span><span class="s1">False</span><span class="s2">).index]</span>
<span class="s2">ct_courses_boundaries.drop(</span><span class="s4">'All'</span><span class="s2">, inplace</span><span class="s3">=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">ct_courses_boundaries.drop(</span><span class="s4">'All'</span><span class="s2">, axis</span><span class="s3">=</span><span class="s5">1</span><span class="s2">, inplace</span><span class="s3">=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s2">fig, ax </span><span class="s3">= </span><span class="s2">plt.subplots(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, figsize</span><span class="s3">=</span><span class="s2">(</span><span class="s5">10</span><span class="s2">, </span><span class="s5">8</span><span class="s2">))</span>

<span class="s2">ax </span><span class="s3">= </span><span class="s2">sns.heatmap(ct_courses_boundaries.T, annot</span><span class="s3">=</span><span class="s1">True</span><span class="s2">, cmap</span><span class="s3">=</span><span class="s4">&quot;YlGnBu&quot;</span><span class="s2">, annot_kws</span><span class="s3">=</span><span class="s2">{</span><span class="s4">&quot;size&quot;</span><span class="s3">: </span><span class="s5">10</span><span class="s2">},</span>
                 <span class="s2">fmt</span><span class="s3">=</span><span class="s4">'g'</span><span class="s2">);  </span><span class="s0">#, vmax=40, cbar_kws = dict(use_gridspec=False,location=&quot;top&quot;)</span>

<span class="s2">ax.set_title(</span><span class="s4">'Number of courses covering planetary boundary themes by faculty'</span><span class="s2">);</span>
<span class="s2">ax.xaxis.tick_top()</span>
<span class="s2">ax.xaxis.set_label_position(</span><span class="s4">'top'</span><span class="s2">)</span>
<span class="s2">ax.tick_params(axis</span><span class="s3">=</span><span class="s4">u'both'</span><span class="s2">, which</span><span class="s3">=</span><span class="s4">u'both'</span><span class="s2">, length</span><span class="s3">=</span><span class="s5">0</span><span class="s2">)</span>

<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span><span class="s2">social_foundations_data </span><span class="s3">= </span><span class="s2">categorical_data[categorical_data[</span><span class="s4">&quot;Theme&quot;</span><span class="s2">].isin(social_foundations)]</span>
<span class="s2">ct_courses_foundations </span><span class="s3">= </span><span class="s2">pd.crosstab(index</span><span class="s3">=</span><span class="s2">social_foundations_data[</span><span class="s4">'FacultyCode'</span><span class="s2">],</span>
                                     <span class="s2">columns</span><span class="s3">=</span><span class="s2">social_foundations_data[</span><span class="s4">'Theme'</span><span class="s2">],</span>
                                     <span class="s2">values</span><span class="s3">=</span><span class="s2">social_foundations_data[</span><span class="s4">'CourseCode'</span><span class="s2">], aggfunc</span><span class="s3">=</span><span class="s4">&quot;nunique&quot;</span><span class="s2">,</span>
                                     <span class="s2">dropna</span><span class="s3">=</span><span class="s1">False</span><span class="s2">, margins</span><span class="s3">=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s2">ct_courses_foundations </span><span class="s3">= </span><span class="s2">ct_courses_foundations.loc[</span>
    <span class="s2">ct_courses_foundations.mean(axis</span><span class="s3">=</span><span class="s5">1</span><span class="s2">).sort_values(ascending</span><span class="s3">=</span><span class="s1">False</span><span class="s2">).index]</span>
<span class="s2">ct_courses_foundations.drop(</span><span class="s4">'All'</span><span class="s2">, inplace</span><span class="s3">=</span><span class="s1">True</span><span class="s2">)</span>
<span class="s2">ct_courses_foundations.drop(</span><span class="s4">'All'</span><span class="s2">, axis</span><span class="s3">=</span><span class="s5">1</span><span class="s2">, inplace</span><span class="s3">=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s2">fig, ax </span><span class="s3">= </span><span class="s2">plt.subplots(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, figsize</span><span class="s3">=</span><span class="s2">(</span><span class="s5">10</span><span class="s2">, </span><span class="s5">8</span><span class="s2">))</span>

<span class="s2">ax </span><span class="s3">= </span><span class="s2">sns.heatmap(ct_courses_foundations.T, annot</span><span class="s3">=</span><span class="s1">True</span><span class="s2">, cmap</span><span class="s3">=</span><span class="s4">&quot;YlGnBu&quot;</span><span class="s2">, annot_kws</span><span class="s3">=</span><span class="s2">{</span><span class="s4">&quot;size&quot;</span><span class="s3">: </span><span class="s5">10</span><span class="s2">},</span>
                 <span class="s2">fmt</span><span class="s3">=</span><span class="s4">'g'</span><span class="s2">);  </span><span class="s0">#, vmax=40, cbar_kws = dict(use_gridspec=False,location=&quot;top&quot;)</span>

<span class="s2">ax.set_title(</span><span class="s4">'Number of courses covering social foundations by faculty'</span><span class="s2">)</span>
<span class="s2">ax.xaxis.tick_top()</span>
<span class="s2">ax.xaxis.set_label_position(</span><span class="s4">'top'</span><span class="s2">)</span>
<span class="s2">ax.tick_params(axis</span><span class="s3">=</span><span class="s4">u'both'</span><span class="s2">, which</span><span class="s3">=</span><span class="s4">u'both'</span><span class="s2">, length</span><span class="s3">=</span><span class="s5">0</span><span class="s2">)</span>

<span class="s2">plt.show()</span>
<span class="s0">#%% 
</span></pre>
</body>
</html>
